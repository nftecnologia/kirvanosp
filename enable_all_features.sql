-- Script SQL para habilitar todas as features premium do Kirvano
-- Executar via: railway connect postgres < enable_all_features.sql

-- 1. Habilitar Direct Uploads (melhor performance)
UPDATE installation_configs 
SET serialized_value = '--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nvalue: true\n'::jsonb 
WHERE name = 'DIRECT_UPLOADS_ENABLED';

-- 2. Habilitar agentes humanos Instagram
UPDATE installation_configs 
SET serialized_value = '--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nvalue: true\n'::jsonb 
WHERE name = 'ENABLE_INSTAGRAM_CHANNEL_HUMAN_AGENT';

-- 3. Habilitar agentes humanos Messenger
UPDATE installation_configs 
SET serialized_value = '--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nvalue: true\n'::jsonb 
WHERE name = 'ENABLE_MESSENGER_CHANNEL_HUMAN_AGENT';

-- 4. Atualizar ACCOUNT_LEVEL_FEATURE_DEFAULTS para habilitar features premium
UPDATE installation_configs 
SET serialized_value = '"--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\nvalue:\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: inbound_emails\n  display_name: Inbound Emails\n  enabled: true\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: channel_email\n  display_name: Email Channel\n  enabled: true\n  help_url: https://chwt.app/hc/email\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: channel_facebook\n  display_name: Facebook Channel\n  enabled: true\n  help_url: https://chwt.app/hc/fb\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: channel_twitter\n  display_name: Twitter Channel\n  enabled: true\n  deprecated: true\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: ip_lookup\n  display_name: IP Lookup\n  enabled: true\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: disable_branding\n  display_name: Disable Branding\n  enabled: true\n  premium: true\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: email_continuity_on_api_channel\n  display_name: Email Continuity on API Channel\n  enabled: true\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: help_center\n  display_name: Help Center\n  enabled: true\n  help_url: https://chwt.app/hc/help-center\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: agent_bots\n  display_name: Agent Bots\n  enabled: true\n  help_url: https://chwt.app/hc/agent-bots\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: macros\n  display_name: Macros\n  enabled: true\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: agent_management\n  display_name: Agent Management\n  enabled: true\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: team_management\n  display_name: Team Management\n  enabled: true\n  help_url: https://chwt.app/hc/teams\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: inbox_management\n  display_name: Inbox Management\n  enabled: true\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: labels\n  display_name: Labels\n  enabled: true\n  help_url: https://chwt.app/hc/labels\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: custom_attributes\n  display_name: Custom Attributes\n  enabled: true\n  help_url: https://chwt.app/hc/custom-attributes\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: automations\n  display_name: Automations\n  enabled: true\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: canned_responses\n  display_name: Canned Responses\n  enabled: true\n  help_url: https://chwt.app/hc/canned\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: integrations\n  display_name: Integrations\n  enabled: true\n  help_url: https://chwt.app/hc/integrations\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: voice_recorder\n  display_name: Voice Recorder\n  enabled: true\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: mobile_v2\n  display_name: Mobile App V2\n  enabled: true\n  deprecated: false\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: channel_website\n  display_name: Website Channel\n  enabled: true\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: campaigns\n  display_name: Campaigns\n  enabled: true\n  help_url: https://chwt.app/hc/campaigns\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: reports\n  display_name: Reports\n  enabled: true\n  help_url: https://chwt.app/hc/reports\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: crm\n  display_name: CRM\n  enabled: true\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: auto_resolve_conversations\n  display_name: Auto Resolve Conversations\n  enabled: true\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: custom_reply_email\n  display_name: Custom Reply Email\n  enabled: true\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: custom_reply_domain\n  display_name: Custom Reply Domain\n  enabled: true\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: audit_logs\n  display_name: Audit Logs\n  enabled: true\n  premium: true\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: response_bot\n  display_name: Response Bot\n  enabled: true\n  premium: true\n  deprecated: false\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: message_reply_to\n  display_name: Message Reply To\n  enabled: true\n  help_url: https://chwt.app/hc/reply-to\n  deprecated: false\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: insert_article_in_reply\n  display_name: Insert Article in Reply\n  enabled: true\n  deprecated: false\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: inbox_view\n  display_name: Inbox View\n  enabled: true\n  kirvano_internal: true\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: sla\n  display_name: SLA\n  enabled: true\n  premium: true\n  help_url: https://chwt.app/hc/sla\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: help_center_embedding_search\n  display_name: Help Center Embedding Search\n  enabled: true\n  premium: true\n  kirvano_internal: true\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: linear_integration\n  display_name: Linear Integration\n  enabled: true\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: captain_integration\n  display_name: Captain\n  enabled: true\n  premium: true\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: custom_roles\n  display_name: Custom Roles\n  enabled: true\n  premium: true\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: kirvano_v4\n  display_name: Kirvano V4\n  enabled: true\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: report_v4\n  display_name: Report V4\n  enabled: true\n  deprecated: false\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: contact_kirvano_support_team\n  display_name: Contact Kirvano Support Team\n  enabled: true\n  kirvano_internal: true\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: shopify_integration\n  display_name: Shopify Integration\n  enabled: true\n  kirvano_internal: true\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: search_with_gin\n  display_name: Search messages with GIN\n  enabled: true\n  kirvano_internal: true\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: channel_instagram\n  display_name: Instagram Channel\n  enabled: true\n- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\n  name: crm_integration\n  display_name: CRM Integration\n  enabled: true\n"'::jsonb 
WHERE name = 'ACCOUNT_LEVEL_FEATURE_DEFAULTS';

-- Verificar atualizações
SELECT 'Features atualizadas:' as status;
SELECT name, 
  CASE 
    WHEN serialized_value::text LIKE '%true%' THEN 'HABILITADO' 
    ELSE 'DESABILITADO' 
  END as status
FROM installation_configs 
WHERE name IN (
  'DIRECT_UPLOADS_ENABLED',
  'ENABLE_INSTAGRAM_CHANNEL_HUMAN_AGENT', 
  'ENABLE_MESSENGER_CHANNEL_HUMAN_AGENT',
  'ACCOUNT_LEVEL_FEATURE_DEFAULTS'
);