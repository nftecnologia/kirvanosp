#!/bin/bash
set -e

# Remove um PID file pré-existente do servidor.
rm -f /app/tmp/pids/server.pid

# Criar diretórios necessários
mkdir -p /app/log /app/tmp/pids

# Configurar ambiente de produção
export RAILS_ENV="${RAILS_ENV:-production}"

echo "Iniciando aplicação em modo $RAILS_ENV..."

# Sempre executar migrações e preparar banco
echo "Executando migrações e preparação do banco..."
bundle exec rake db:prepare || echo "Erro nas migrações, continuando..."

# Executa o comando passado
exec "$@" 